package cc.unknown.module.impl.exploit;

import java.util.concurrent.ConcurrentLinkedQueue;

import cc.unknown.event.impl.EventLink;
import cc.unknown.event.impl.network.PacketEvent;
import cc.unknown.event.impl.player.TickEvent;
import cc.unknown.module.impl.Module;
import cc.unknown.module.impl.api.Category;
import cc.unknown.module.impl.api.Register;
import cc.unknown.module.setting.impl.SliderValue;
import cc.unknown.utils.network.TimedPacket;
import net.minecraft.network.Packet;

@SuppressWarnings("rawtypes")
@Register(name = "Ping", category = Category.Exploit)
public class Ping extends Module {

	private final ConcurrentLinkedQueue<TimedPacket> packets = new ConcurrentLinkedQueue<>();
	private SliderValue morePing = new SliderValue("Additional Ping", 250, 0, 1000, 10);
	
	public Ping() {
		this.registerSetting(morePing);
	}

	@EventLink
	public void onTickPre(TickEvent.Pre e) {
		if (mc.thePlayer != null) {
			for (TimedPacket packet : packets) {
				if (System.currentTimeMillis() > packet.getMillis() + morePing.getInputToInt()) {
					try {
						Packet p = packet.getPacket();
						p.processPacket(mc.thePlayer.sendQueue.getNetworkManager().getNetHandler());
					} catch (Exception exception) {
						exception.printStackTrace();
					}
					packets.remove(packet);
				}
			}
		}
	}

	@EventLink
	public void onPacket(PacketEvent e) {
		if (e.isReceive()) {
			packets.add(new TimedPacket(e.getPacket(), System.currentTimeMillis()));
			e.setCancelled(true);
			getSpoof(e.getPacket());
		}
	}

	private boolean getSpoof(Packet packet) {
		if (IsPlayClientPacket(packet))
			return true;
		return false;
	}

	private boolean IsPlayClientPacket(Packet packet) {
		return (packet instanceof net.minecraft.network.play.server.S0EPacketSpawnObject
				|| packet instanceof net.minecraft.network.play.server.S11PacketSpawnExperienceOrb
				|| packet instanceof net.minecraft.network.play.server.S2CPacketSpawnGlobalEntity
				|| packet instanceof net.minecraft.network.play.server.S0FPacketSpawnMob
				|| packet instanceof net.minecraft.network.play.server.S3BPacketScoreboardObjective
				|| packet instanceof net.minecraft.network.play.server.S10PacketSpawnPainting
				|| packet instanceof net.minecraft.network.play.server.S0CPacketSpawnPlayer
				|| packet instanceof net.minecraft.network.play.server.S0BPacketAnimation
				|| packet instanceof net.minecraft.network.play.server.S37PacketStatistics
				|| packet instanceof net.minecraft.network.play.server.S25PacketBlockBreakAnim
				|| packet instanceof net.minecraft.network.play.server.S36PacketSignEditorOpen
				|| packet instanceof net.minecraft.network.play.server.S35PacketUpdateTileEntity
				|| packet instanceof net.minecraft.network.play.server.S24PacketBlockAction
				|| packet instanceof net.minecraft.network.play.server.S23PacketBlockChange
				|| packet instanceof net.minecraft.network.play.server.S02PacketChat
				|| packet instanceof net.minecraft.network.play.server.S3APacketTabComplete
				|| packet instanceof net.minecraft.network.play.server.S22PacketMultiBlockChange
				|| packet instanceof net.minecraft.network.play.server.S34PacketMaps
				|| packet instanceof net.minecraft.network.play.server.S32PacketConfirmTransaction
				|| packet instanceof net.minecraft.network.play.server.S2EPacketCloseWindow
				|| packet instanceof net.minecraft.network.play.server.S30PacketWindowItems
				|| packet instanceof net.minecraft.network.play.server.S2DPacketOpenWindow
				|| packet instanceof net.minecraft.network.play.server.S31PacketWindowProperty
				|| packet instanceof net.minecraft.network.play.server.S2FPacketSetSlot
				|| packet instanceof net.minecraft.network.play.server.S3FPacketCustomPayload
				|| packet instanceof net.minecraft.network.play.server.S0APacketUseBed
				|| packet instanceof net.minecraft.network.play.server.S19PacketEntityStatus
				|| packet instanceof net.minecraft.network.play.server.S1BPacketEntityAttach
				|| packet instanceof net.minecraft.network.play.server.S27PacketExplosion
				|| packet instanceof net.minecraft.network.play.server.S2BPacketChangeGameState
				|| packet instanceof net.minecraft.network.play.server.S00PacketKeepAlive
				|| packet instanceof net.minecraft.network.play.server.S21PacketChunkData
				|| packet instanceof net.minecraft.network.play.server.S26PacketMapChunkBulk
				|| packet instanceof net.minecraft.network.play.server.S28PacketEffect
				|| packet instanceof net.minecraft.network.play.server.S14PacketEntity
				|| packet instanceof net.minecraft.network.play.server.S08PacketPlayerPosLook
				|| packet instanceof net.minecraft.network.play.server.S2APacketParticles
				|| packet instanceof net.minecraft.network.play.server.S39PacketPlayerAbilities
				|| packet instanceof net.minecraft.network.play.server.S38PacketPlayerListItem
				|| packet instanceof net.minecraft.network.play.server.S13PacketDestroyEntities
				|| packet instanceof net.minecraft.network.play.server.S1EPacketRemoveEntityEffect
				|| packet instanceof net.minecraft.network.play.server.S07PacketRespawn
				|| packet instanceof net.minecraft.network.play.server.S19PacketEntityHeadLook
				|| packet instanceof net.minecraft.network.play.server.S09PacketHeldItemChange
				|| packet instanceof net.minecraft.network.play.server.S3DPacketDisplayScoreboard
				|| packet instanceof net.minecraft.network.play.server.S1CPacketEntityMetadata
				|| packet instanceof net.minecraft.network.play.server.S12PacketEntityVelocity
				|| packet instanceof net.minecraft.network.play.server.S04PacketEntityEquipment
				|| packet instanceof net.minecraft.network.play.server.S1FPacketSetExperience
				|| packet instanceof net.minecraft.network.play.server.S06PacketUpdateHealth
				|| packet instanceof net.minecraft.network.play.server.S3EPacketTeams
				|| packet instanceof net.minecraft.network.play.server.S3CPacketUpdateScore
				|| packet instanceof net.minecraft.network.play.server.S05PacketSpawnPosition
				|| packet instanceof net.minecraft.network.play.server.S03PacketTimeUpdate
				|| packet instanceof net.minecraft.network.play.server.S33PacketUpdateSign
				|| packet instanceof net.minecraft.network.play.server.S29PacketSoundEffect
				|| packet instanceof net.minecraft.network.play.server.S0DPacketCollectItem
				|| packet instanceof net.minecraft.network.play.server.S18PacketEntityTeleport
				|| packet instanceof net.minecraft.network.play.server.S20PacketEntityProperties
				|| packet instanceof net.minecraft.network.play.server.S1DPacketEntityEffect
				|| packet instanceof net.minecraft.network.play.server.S42PacketCombatEvent
				|| packet instanceof net.minecraft.network.play.server.S41PacketServerDifficulty
				|| packet instanceof net.minecraft.network.play.server.S43PacketCamera
				|| packet instanceof net.minecraft.network.play.server.S44PacketWorldBorder
				|| packet instanceof net.minecraft.network.play.server.S45PacketTitle
				|| packet instanceof net.minecraft.network.play.server.S46PacketSetCompressionLevel
				|| packet instanceof net.minecraft.network.play.server.S47PacketPlayerListHeaderFooter
				|| packet instanceof net.minecraft.network.play.server.S48PacketResourcePackSend
				|| packet instanceof net.minecraft.network.play.server.S49PacketUpdateEntityNBT);
	}
}
